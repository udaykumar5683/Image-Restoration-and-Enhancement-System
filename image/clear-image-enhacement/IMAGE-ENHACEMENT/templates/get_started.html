<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Started - Clear Image Enhancement</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --speed-top: 90s; --speed-bottom: 150s; --glass-opacity: 0.28; --glass-blur: 12px; --glass-radius: 20px; --glass-border1: rgba(255,255,255,0.35); --glass-border2: rgba(255,255,255,0.1); --glass-fill1: rgba(255,255,255,0.24); --glass-fill2: rgba(255,255,255,0.16); --glass-shadow: rgba(17,24,39,0.28); --accent1: #4f46e5; --accent2: #0ea5e9; --hero-color: #0f172a; --hero-color-hover: #0b5bd3; --hero-color-active: #0a4ab2; }
        body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; opacity: 0; transition: opacity 280ms ease; }
        body.loaded { opacity: 1; }
        .loader { border: 8px solid #e5e7eb; border-top: 8px solid #3b82f6; border-radius: 50%; width: 60px; height: 60px; animation: spin 2s linear infinite; position: absolute; top: 50%; left: 50%; margin-left: -30px; margin-top: -30px; z-index: 30; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .primary-bg { position: fixed; inset: 0; pointer-events: none; z-index: 0; background-position: center; background-repeat: no-repeat; background-size: cover; filter: saturate(0.9) blur(var(--glass-blur)); opacity: 0.22; }
        .bg-layer { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 1; opacity: 0; transition: opacity 360ms ease; content-visibility: auto; }
        .bg-layer.ready { opacity: 1; }
        .page-glass { position: fixed; inset: 0; pointer-events: none; z-index: 5; backdrop-filter: saturate(1.2) blur(var(--glass-blur)); -webkit-backdrop-filter: saturate(1.2) blur(var(--glass-blur)); background: radial-gradient(800px 400px at 20% 10%, rgba(255,255,255,0.30), rgba(255,255,255,0.06) 60%), linear-gradient(180deg, rgba(79,70,229,0.10), rgba(14,165,233,0.08)); }
        .bg-strip { position: absolute; left: 0; right: 0; display: flex; align-items: center; gap: 2rem; contain: layout paint style; transition: transform 300ms ease, opacity 300ms ease; backface-visibility: hidden; transform: translateZ(0); }
        .scroll-track { display: inline-flex; gap: 2rem; will-change: transform; backface-visibility: hidden; }
        .bg-item { height: clamp(56px, 10vw, 96px); width: auto; object-fit: contain; filter: saturate(0.9); }
        .dir-lr { will-change: transform; animation: swayY 16s ease-in-out infinite alternate; }
        .dir-rl { will-change: transform; animation: swayY 12s ease-in-out infinite alternate; }
        .dir-lr .scroll-track { animation: loop-right var(--speed) linear infinite; }
        .dir-rl .scroll-track { animation: loop-left var(--speed) linear infinite; }
        .start-top { will-change: transform; animation: swayY 16s ease-in-out infinite alternate; }
        .start-bottom { will-change: transform; animation: swayY 12s ease-in-out infinite alternate; }
        .start-top .scroll-track { animation: loop-left var(--speed-top) linear infinite; }
        .start-bottom .scroll-track { animation: loop-right var(--speed-bottom) linear infinite; }
        @keyframes loop-left { 0% { transform: translate3d(0,0,0); } 100% { transform: translate3d(-50%,0,0); } }
        @keyframes loop-right { 0% { transform: translate3d(-50%,0,0); } 100% { transform: translate3d(0,0,0); } }
        @media (prefers-reduced-motion: reduce) { .dir-lr, .dir-rl { animation: none; } .dir-lr .scroll-track, .dir-rl .scroll-track { animation-duration: calc(var(--speed) * 2); } }
        @supports not (backdrop-filter: blur(1px)) { .page-glass { background: rgba(255,255,255,0.06); } }
        @keyframes swayY { 0% { transform: translate3d(0,0,0); } 100% { transform: translate3d(0,6px,0); } }
        /* Nav enhancements */
        .site-nav { position: relative; padding: 12px 16px; border-radius: 16px; background: rgba(255,255,255,0.85); backdrop-filter: saturate(1.2) blur(6px); box-shadow: 0 8px 28px rgba(17,24,39,0.18); border: 1px solid rgba(17,24,39,0.12); will-change: transform, box-shadow; transition: box-shadow 220ms ease, transform 220ms ease; }
        .site-nav:hover, .site-nav:focus-within { box-shadow: 0 12px 36px rgba(17,24,39,0.25); transform: translateZ(0) scale(1.01); }
        .site-nav a { position: relative; color: #0f172a; font-weight: 700; text-decoration: none; outline: none; }
        .site-nav a:hover, .site-nav a:focus { color: #0b5bd3; }
        .site-nav a:focus-visible { outline: 3px solid #93c5fd; outline-offset: 4px; border-radius: 8px; }
        .site-nav a::after { content: ""; position: absolute; left: 0; bottom: -6px; height: 3px; width: 0%; background: linear-gradient(90deg, #4f46e5, #0ea5e9); border-radius: 3px; transition: width 220ms ease; }
        .site-nav a:hover::after, .site-nav a:focus::after { width: 100%; }
        .site-nav a[aria-current="page"]::after { width: 100%; }
        /* active indicator bar */
        .site-nav::before { content: ""; position: absolute; left: 16px; right: 16px; bottom: 0; height: 2px; background: linear-gradient(90deg, rgba(79,70,229,0.3), rgba(14,165,233,0.3)); border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; }
        /* parallax subtle movement */
        .site-nav { transform: translateY(var(--nav-ty, 0px)); }
        @media (max-width: 640px) {
            .site-nav { padding: 10px 12px; border-radius: 12px; }
            .site-nav a { font-weight: 600; }
        }
        .glass-card { position: relative; width: 100%; max-width: min(100%, 64rem); margin: 0 auto; padding: clamp(16px, 2.6vw, 40px); border-radius: var(--glass-radius); backdrop-filter: saturate(1.1) blur(var(--glass-blur)); -webkit-backdrop-filter: saturate(1.1) blur(var(--glass-blur)); background: linear-gradient(180deg, var(--glass-fill1), var(--glass-fill2)) padding-box, linear-gradient(180deg, var(--glass-border1), var(--glass-border2)) border-box; border: 1px solid transparent; box-shadow: inset 0 1px 8px rgba(255,255,255,0.06), 0 24px 68px var(--glass-shadow); will-change: transform, box-shadow; transition: transform 240ms ease, box-shadow 240ms ease, background 240ms ease; }
        .glass-card:hover, .glass-card:focus-within { transform: translateZ(0) scale(1.01); box-shadow: inset 0 1px 8px rgba(255,255,255,0.06), 0 32px 84px rgba(17,24,39,0.35); }
        .glass-card::before { content: ""; position: absolute; inset: -1px; border-radius: inherit; background: radial-gradient(280px 140px at var(--lx, 30%) var(--ly, 30%), rgba(147,197,253,0.25), transparent 60%), linear-gradient(90deg, rgba(79,70,229,0.06), rgba(14,165,233,0.06)); opacity: 0; transition: opacity 220ms ease; pointer-events: none; }
        .glass-card:hover::before, .glass-card:focus-within::before { opacity: 1; }
        .glass-card .btn { border-radius: 14px; box-shadow: 0 8px 22px rgba(14,165,233,0.28); transition: transform 180ms ease, box-shadow 180ms ease, background 180ms ease; }
        .glass-card .btn:hover, .glass-card .btn:focus-visible { transform: translateY(-1px); box-shadow: 0 12px 32px rgba(14,165,233,0.36); }
        @media (max-width: 640px) { .glass-card { border-radius: 16px; } }
        @media (min-width: 1280px) { .glass-card { border-radius: 24px; } }
    </style>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="min-h-screen">
    <div class="primary-bg"></div>
    <div id="bg-layer" class="bg-layer"></div>
    <div class="page-glass"></div>

    <header class="relative z-10 container mx-auto px-6 pt-8">
        <nav class="flex items-center justify-between site-nav" role="navigation" aria-label="Primary navigation">
            <a href="/" class="text-gray-900 font-semibold hover:underline">Clear Image Enhancement</a>
            <a href="/" class="text-sm text-gray-500 hover:text-gray-700" aria-label="Back to home">Back</a>
        </nav>
    </header>

    <main class="relative z-10 container mx-auto px-6 pt-12 pb-24">
        <section class="max-w-4xl mx-auto text-center hero-text">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-gray-900">Upload and Enhance</h1>
            <p class="mt-3 text-lg text-gray-600">Use our smart pipeline to improve exposure, contrast, and clarity.</p>
        </section>
        <section class="mt-10">
            <div class="glass-card rounded-2xl p-8 md:p-10 max-w-3xl mx-auto" tabindex="0" aria-label="Upload card">
                <form id="upload-form" class="flex flex-col items-center">
                    <label class="sr-only" for="file-input">Select image</label>
                    <input type="file" id="file-input" name="file" accept="image/*" class="mb-4 p-3 border rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Upload image">
                    <button type="submit" class="btn bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">Enhance Image</button>
                </form>
                <div id="loader" class="loader hidden" aria-live="polite" aria-busy="true"></div>
                <div id="results" class="mt-8 hidden">
                    <h2 class="text-2xl font-bold text-center text-gray-900 mb-4">Results</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold text-center mb-2">Original</h3>
                            <img id="original-image" src="" alt="Original image" class="rounded-lg shadow-md w-full" loading="lazy">
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-center mb-2">Enhanced</h3>
                            <img id="enhanced-image" src="" alt="Enhanced image" class="rounded-lg shadow-md w-full" loading="lazy">
                            <a id="download-link" href="" download class="block text-center bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 mt-4 transition-colors font-semibold">Download Enhanced Image</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => { document.body.classList.add('loaded'); });
        // Nav micro-interactions: active indicator + parallax on scroll
        (function() {
            const nav = document.querySelector('nav.site-nav');
            const links = nav ? nav.querySelectorAll('a') : [];
            const path = window.location.pathname;
            links.forEach(a => { if (a.getAttribute('href') === path) a.setAttribute('aria-current', 'page'); });
            let ticking = false;
            const onScroll = () => {
                const ty = Math.min(6, window.scrollY * 0.05);
                if (nav) nav.style.setProperty('--nav-ty', ty + 'px');
                ticking = false;
            };
            window.addEventListener('scroll', () => { if (!ticking) { window.requestAnimationFrame(onScroll); ticking = true; } }, { passive: true });
        })();
        const backgroundImages = {{ background_images|tojson }};
        let io;
        const buildTrack = (track, images) => {
            const sources = images.concat(images);
            sources.forEach((src, i) => {
                const img = new Image();
                img.dataset.src = src;
                img.alt = '';
                img.setAttribute('aria-hidden', 'true');
                img.loading = 'lazy';
                img.decoding = 'async';
                img.fetchPriority = 'low';
                img.draggable = false;
                img.className = 'bg-item';
                img.style.opacity = i % 3 === 0 ? '0.6' : i % 3 === 1 ? '0.45' : '0.5';
                track.appendChild(img);
                if (io) io.observe(img);
            });
        };
        const preload = src => new Promise(r => { const i = new Image(); i.onload = () => r(); i.onerror = () => r(); i.src = src; });
        const buildLayer = (container, images, y, height, dir, speed, index) => {
            const strip = document.createElement('div');
            strip.className = 'bg-strip ' + (dir==='lr' ? 'dir-lr' : 'dir-rl');
            strip.style.top = y + 'px';
            strip.style.height = height + 'px';
            strip.style.opacity = dir==='lr' ? '0.72' : '0.48';
            strip.style.zIndex = String(10 + (dir==='lr' ? 1 : 0));
            const track = document.createElement('div');
            track.className = 'scroll-track';
            track.style.setProperty('--speed', speed + 's');
            track.style.animationDuration = speed + 's';
            track.style.animationTimingFunction = 'linear';
            if (index === 0 || index === 2) { track.style.animationDuration = (speed + 20) + 's'; track.style.animationTimingFunction = 'ease-in-out'; }
            track.style.animationDelay = '0s';
            strip.style.transform = 'translateZ(0)';
            track.style.backfaceVisibility = 'hidden';
            track.style.willChange = 'transform';
            buildTrack(track, images);
            strip.appendChild(track);
            container.appendChild(strip);
        };
        const computeLayers = () => {
            const container = document.getElementById('bg-layer');
            if (!container) return;
            container.innerHTML = '';
            const viewportH = window.innerHeight;
            const rowH = Math.max(56, Math.min(window.innerWidth * 0.10, 96));
            const gap = 10;
            const step = rowH + gap;
            const count = Math.ceil((viewportH + gap) / step);
            const shuffled = backgroundImages.slice().sort(() => Math.random() - 0.5);
            const base = 80;
            const delta = 8;
            for (let i = 0; i < count; i++) {
                const dir = (i % 2 === 0) ? 'lr' : 'rl';
                const speed = base + (i * delta);
                const offset = i % shuffled.length;
                const layerImages = [];
                for (let k = 0; k < shuffled.length; k++) {
                    layerImages.push(shuffled[(offset + k) % shuffled.length]);
                }
                const y = i * step;
                buildLayer(container, layerImages, y, rowH, dir, speed, i);
            }
        };
        (async () => {
            await Promise.all(backgroundImages.map(preload));
            const primary = document.querySelector('.primary-bg');
            if (primary && backgroundImages.length) {
                const pick = backgroundImages[Math.floor(Math.random()*backgroundImages.length)];
                primary.style.backgroundImage = 'url(' + pick + ')';
            }
            io = new IntersectionObserver((entries, obs) => { entries.forEach(e => { const t = e.target; if (e.isIntersecting && t.dataset && t.dataset.src && !t.src) { t.src = t.dataset.src; obs.unobserve(t); } }); }, { root: null, rootMargin: '200px', threshold: 0.01 });
            computeLayers();
            document.getElementById('bg-layer')?.classList.add('ready');
            window.addEventListener('resize', computeLayers, { passive: true });
        })();
        (function(){
            const card = document.querySelector('.glass-card');
            if (!card) return;
            let raf = null; let lx = 30; let ly = 30;
            const setLight = (x, y) => { card.style.setProperty('--lx', x + '%'); card.style.setProperty('--ly', y + '%'); };
            const handle = (clientX, clientY) => {
                const r = card.getBoundingClientRect();
                const nx = ((clientX - r.left) / r.width) * 100;
                const ny = ((clientY - r.top) / r.height) * 100;
                lx = Math.max(0, Math.min(100, nx));
                ly = Math.max(0, Math.min(100, ny));
                if (!raf) { raf = requestAnimationFrame(() => { setLight(lx, ly); raf = null; }); }
            };
            card.addEventListener('mousemove', e => handle(e.clientX, e.clientY));
            card.addEventListener('touchmove', e => { if (!e.touches || !e.touches[0]) return; const t = e.touches[0]; handle(t.clientX, t.clientY); }, { passive: true });
        })();

        const uploadForm = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const loader = document.getElementById('loader');
        const resultsDiv = document.getElementById('results');
        const originalImage = document.getElementById('original-image');
        const enhancedImage = document.getElementById('enhanced-image');
        const downloadLink = document.getElementById('download-link');

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const file = fileInput.files[0];
            if (!file) { alert('Please select an image'); return; }
            const formData = new FormData();
            formData.append('file', file);
            loader.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            try {
                const response = await fetch('/enhance', { method: 'POST', body: formData });
                const data = await response.json();
                if (data.error) { alert(data.error); }
                else {
                    originalImage.src = data.original;
                    enhancedImage.src = data.enhanced;
                    downloadLink.href = data.enhanced;
                    resultsDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred during enhancement.');
            } finally {
                loader.classList.add('hidden');
            }
        });
        (function(){
            const hero = document.querySelector('.hero-text');
            const h1 = hero ? hero.querySelector('h1') : null;
            if (!hero || !h1) return;
            const parseRGB = v => {
                if (!v) return null;
                if (v.startsWith('#')) {
                    let r=0,g=0,b=0;
                    if (v.length===7) { r=parseInt(v.slice(1,3),16); g=parseInt(v.slice(3,5),16); b=parseInt(v.slice(5,7),16); }
                    else if (v.length===4) { r=parseInt(v[1]+v[1],16); g=parseInt(v[2]+v[2],16); b=parseInt(v[3]+v[3],16); }
                    return {r,g,b,a:1};
                }
                const m = v.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d\.]+))?\)/);
                if (!m) return null;
                return { r: parseInt(m[1],10), g: parseInt(m[2],10), b: parseInt(m[3],10), a: m[4]!==undefined? parseFloat(m[4]):1 };
            };
            const getBg = el => {
                let cur = el;
                while (cur) {
                    const cs = window.getComputedStyle(cur);
                    const bg = parseRGB(cs.backgroundColor);
                    if (bg && bg.a>0 && !(bg.r===0&&bg.g===0&&bg.b===0&&bg.a===0)) return bg;
                    cur = cur.parentElement;
                }
                return null;
            };
            const isBlack = c => c && c.r===0 && c.g===0 && c.b===0 && c.a===1;
            const isWhite = c => c && c.r===255 && c.g===255 && c.b===255 && c.a===1;
            const luminance = c => {
                const srgb = [c.r/255, c.g/255, c.b/255].map(v => v<=0.03928 ? v/12.92 : Math.pow((v+0.055)/1.055,2.4));
                return 0.2126*srgb[0]+0.7152*srgb[1]+0.0722*srgb[2];
            };
            const choose = c => {
                if (isBlack(c)) return '#FFFFFF';
                if (isWhite(c)) return '#000000';
                if (!c) return '#000000';
                const L = luminance(c);
                const contrastWhite = (1.0+0.05)/(L+0.05);
                const contrastBlack = (L+0.05)/(0.0+0.05);
                return contrastWhite>=contrastBlack ? '#FFFFFF' : '#000000';
            };
            let ticking=false;
            const apply = () => { const bg = getBg(hero); const color = choose(bg); h1.style.color = color; };
            apply();
            const onScroll = () => { if (ticking) return; ticking=true; requestAnimationFrame(() => { apply(); ticking=false; }); };
            window.addEventListener('scroll', onScroll, { passive: true });
            const obs = new MutationObserver(() => apply());
            obs.observe(hero, { attributes:true, attributeFilter:['style','class'] });
        })();
    </script>
</body>
</html>
        .hero-text { color: var(--hero-color); }
